<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Gi·ªè h√†ng - C√† Ph√™ ƒê·∫≠m ƒê√†</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="styles/user.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </head>
    <body>
        <!-- Header -->
        <header class="header">
            <div class="container nav">
                <div class="brand">
                    <a href="index.html">
                        <img src="https://scontent-hkg4-2.xx.fbcdn.net/v/t1.15752-9/552703956_771855105468883_1116774372539651057_n.png?_nc_cat=111&ccb=1-7&_nc_sid=0024fc&_nc_eui2=AeHOBCj3lX8HaOlEvmrFw3xlBrfZDT56J6MGt9kNPnono-ZY8pwnFeBxIqW3onZN3zta5vYTCGt1khW091oaxsr0&_nc_ohc=gpp9itW4IqcQ7kNvwEoG1Qq&_nc_oc=Admu0eUlmvebDWAO50DQbndetZfv1eoK4Pdnm2Fql2WZTtukjFnDuqMCp5j7orfE930&_nc_ad=z-m&_nc_cid=0&_nc_zt=23&_nc_ht=scontent-hkg4-2.xx&oh=03_Q7cD3QHC08gLgVHXrZ8zt8znzke_wz-InehjvWetDnfV-WoDKQ&oe=68FBBCA9" alt="Logo C√† Ph√™ ƒê·∫≠m ƒê√†" class="brand-logo">
                        <span class="brand-name">C√† Ph√™ ƒê·∫≠m ƒê√†</span>
                    </a>
                </div>

                <form class="search-bar" role="search" id="searchForm" onsubmit="handleSearch(event)">
                    <button class="search-btn" type="submit">üîç</button>
                    <input type="text" id="searchInput" placeholder="T√¨m s·∫£n ph·∫©m..." aria-label="T√¨m ki·∫øm" />
                </form>

                <nav class="menu" aria-label="Ch√≠nh">
                    <a href="products.html">S·∫£n ph·∫©m</a>
                    <a href="index.html#ve-chung-toi">Gi·ªõi thi·ªáu</a>
                    <a href="index.html#loi-ich">L·ª£i √≠ch</a>
                    <a href="index.html#lien-he">Li√™n h·ªá</a>
                    <a href="cart.html" class="badge" aria-label="Gi·ªè h√†ng">
                        Gi·ªè h√†ng
                        <span id="cart-badge" class="badge-count">0</span>
                    </a>
                </nav>

                <button id="menuBtn" class="mobile-toggle" aria-expanded="false" aria-controls="mobileMenu">
                    Menu
                </button>
            </div>
        </header>

        <nav id="mobileMenu" hidden class="mobile-menu"></nav>

        <main class="container" style="padding: 24px 20px;">
            <h1 class="section-title">Gi·ªè h√†ng c·ªßa b·∫°n</h1>
            <div style="display:grid; grid-template-columns: 1.2fr 0.8fr; gap: 20px; align-items:start; margin-top:16px;">
                <!-- Cart items -->
                <section style="background:#fff; border-radius:12px; padding:16px; box-shadow: 0 6px 18px rgba(0,0,0,0.06);">
                    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                        <input type="checkbox" id="selectAll" />
                        <label for="selectAll" style="user-select:none; cursor:pointer;">Ch·ªçn t·∫•t c·∫£</label>
                    </div>
                    <div id="cartItems"></div>
                </section>

                <!-- Summary -->
                <aside style="background:#fff; border-radius:12px; padding:16px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); position: sticky; top: 84px;">
                    <h3>T·ªïng k·∫øt</h3>
                    <div style="display:grid; gap:8px; margin-top:10px;">
                        <div style="display:flex; justify-content:space-between;"><span>ƒê√£ ch·ªçn</span><strong id="selectedCount">0</strong></div>
                        <div style="display:flex; justify-content:space-between;"><span>T·∫°m t√≠nh</span><strong id="subtotal">0ƒë</strong></div>
                    </div>
                    <div style="display:flex; gap:12px; margin-top:12px;">
                        <a href="products.html" style="flex:1; text-align:center; padding:12px 14px; background:#fff; color:#333; border: 1px solid #ddd; border-radius: 8px; font-weight:600;">Ti·∫øp t·ª•c mua</a>
                        <a href="checkout.html" style="flex:1; text-align:center; padding:12px 14px; background: var(--gold); color: var(--coffee-900); border:none; border-radius: 8px; font-weight: 600;">Thanh to√°n</a>
                    </div>
                </aside>
            </div>
        </main>

        <footer id="lien-he">
            <div class="container foot">
                <div>
                    <h4>C√† Ph√™ ƒê·∫≠m ƒê√†</h4>
                    <p>H·∫°t c√† ph√™ rang xay ch·∫•t l∆∞·ª£ng cao. ƒê·ªìng h√†nh c√πng ly c√† ph√™ ngon m·ªói ng√†y.</p>
                </div>
                <div>
                    <h4>Li√™n h·ªá</h4>
                    <p>Hotline: 0901 234 567<br/>Email: hello@caphedamda.vn</p>
                </div>
                <div>
                    <h4>ƒê·ªãa ch·ªâ</h4>
                    <p>123 Phin Street, Qu·∫≠n Caffeine, TP.HCM</p>
                </div>
            </div>
            <div class="container copyright">
                ¬© 2025 C√† Ph√™ ƒê·∫≠m ƒê√†. All rights reserved.
            </div>
        </footer>

        <script type="module">
            import { Products, Types } from './scripts/db.js';

            function formatCurrency(v){ return new Intl.NumberFormat('vi-VN').format(v); }
            function getCart(){ try { return JSON.parse(localStorage.getItem('cart')||'[]'); } catch { return []; } }
            function setCart(c){ localStorage.setItem('cart', JSON.stringify(c)); }
            function updateCartBadge(){ const b=document.getElementById('cart-badge'); if(b) b.textContent=getCart().length; }

            function render(){
                const box = document.getElementById('cartItems');
                const subtotalEl = document.getElementById('subtotal');
                const selectedCountEl = document.getElementById('selectedCount');
                const cart = getCart();
                let selected = getSelectedIds();
                const selectedRaw = localStorage.getItem('cart_selected');
                if(selectedRaw === null && cart.length > 0){ selected = new Set(cart.map(i=>i.id)); setSelectedIds(selected); }
                if(cart.length===0){
                    box.innerHTML = '<p>Gi·ªè h√†ng tr·ªëng.</p>';
                    subtotalEl.textContent = '0ƒë';
                    if(selectedCountEl) selectedCountEl.textContent = '0';
                    return;
                }
                box.innerHTML = cart.map(item=>`
                    <div class="cart-item" data-id="${item.id}" style="padding: 12px 0; border-bottom: 1px solid #f2f2f2;">
                        <div style="display:flex; align-items:start; justify-content: space-between; gap: 10px;">
                            <div style="display:flex; gap:10px; align-items:start; flex:1; min-width:0;">
                                <input type="checkbox" class="select-item" ${selected.has(item.id)?'checked':''} />
                                <div style="font-weight:600;">${item.name}</div>
                            </div>
                            <div style="min-width:100px; text-align:right; font-weight:600; color:#c62828;">${formatCurrency(item.price * item.quantity)}ƒë</div>
                        </div>
                        <div style="display:flex; align-items:center; gap:6px; color:#888; font-size: 12px; margin-top:6px;">
                            <span style="color:#999;">‚úé</span>
                            <input class="note-input" type="text" placeholder="Kh√¥ng c√≥ ghi ch√∫" value="${item.note||''}" style="flex:1; min-width:0; border:none; border-bottom:1px dashed #e0e0e0; padding:4px 0; outline:none;" />
                        </div>
                        <div style="display:flex; align-items:center; gap:8px; margin-top:8px;">
                            <button class="qty-dec" aria-label="Gi·∫£m" style="width:28px; height:28px; border:1px solid #ddd; background:#fff;">-</button>
                            <input class="qty-input" type="number" min="1" value="${item.quantity}" style="width:48px; text-align:center; border:1px solid #ddd; height:28px;" />
                            <button class="qty-inc" aria-label="TƒÉng" style="width:28px; height:28px; border:1px solid #ddd; background:#fff;">+</button>
                            <button class="remove-item" aria-label="X√≥a" style="margin-left:8px; background: #fff; border: 1px solid #f2d7d7; color:#c62828; cursor:pointer; height:28px; padding:0 10px; border-radius:6px;">X√≥a</button>
                        </div>
                    </div>
                `).join('');
                const selectedCart = cart.filter(i=>selected.has(i.id));
                const subtotal = selectedCart.reduce((s,i)=>s+i.price*i.quantity,0);
                subtotalEl.textContent = `${formatCurrency(subtotal)}ƒë`;
                if(selectedCountEl) selectedCountEl.textContent = String(selectedCart.length);

                box.querySelectorAll('.qty-dec').forEach(btn=>btn.addEventListener('click', onDec));
                box.querySelectorAll('.qty-inc').forEach(btn=>btn.addEventListener('click', onInc));
                box.querySelectorAll('.qty-input').forEach(inp=>inp.addEventListener('change', onChange));
                box.querySelectorAll('.remove-item').forEach(btn=>btn.addEventListener('click', onRemove));
                box.querySelectorAll('.note-input').forEach(inp=>inp.addEventListener('change', onChangeNote));
                box.querySelectorAll('.select-item').forEach(inp=>inp.addEventListener('change', onToggleSelect));

                const all = document.getElementById('selectAll');
                if(all){
                    all.checked = selectedCart.length === cart.length;
                    all.indeterminate = selectedCart.length>0 && selectedCart.length<cart.length;
                    all.onchange = ()=>{ if(all.checked){ setSelectedIds(new Set(cart.map(i=>i.id))); } else { setSelectedIds(new Set()); } render(); };
                }
            }

            function onDec(e){ const id=e.target.closest('.cart-item')?.dataset.id; if(!id) return; const c=getCart(); const it=c.find(i=>i.id===id); if(!it) return; it.quantity=Math.max(1,it.quantity-1); setCart(c); updateCartBadge(); render(); }
            function onInc(e){ const id=e.target.closest('.cart-item')?.dataset.id; if(!id) return; const c=getCart(); const it=c.find(i=>i.id===id); if(!it) return; it.quantity+=1; setCart(c); updateCartBadge(); render(); }
            function onChange(e){ const id=e.target.closest('.cart-item')?.dataset.id; const v=Math.max(1, parseInt(e.target.value||'1',10)); const c=getCart(); const it=c.find(i=>i.id===id); if(!it) return; it.quantity=v; setCart(c); updateCartBadge(); render(); }
            function onRemove(e){ const id=e.target.closest('.cart-item')?.dataset.id; const next=getCart().filter(i=>i.id!==id); setCart(next); updateCartBadge(); render(); }
            function onChangeNote(e){ const id=e.target.closest('.cart-item')?.dataset.id; if(!id) return; const c=getCart(); const it=c.find(i=>i.id===id); if(!it) return; it.note = e.target.value.trim(); setCart(c); }
            function getSelectedIds(){ try { return new Set(JSON.parse(localStorage.getItem('cart_selected')||'[]')); } catch { return new Set(); } }
            function setSelectedIds(set){ localStorage.setItem('cart_selected', JSON.stringify(Array.from(set))); }
            function onToggleSelect(e){ const id=e.target.closest('.cart-item')?.dataset.id; if(!id) return; const sel=getSelectedIds(); if(e.target.checked){ sel.add(id); } else { sel.delete(id); } setSelectedIds(sel); render(); }

            // Search submit
            function handleSearch(event){ event.preventDefault(); const q=document.getElementById('searchInput').value.trim(); if(q){ window.location.href = `products.html?search=${encodeURIComponent(q)}`; } }
            window.handleSearch = handleSearch;

            // Init
            updateCartBadge();
            render();
        </script>
    </body>
</html>


